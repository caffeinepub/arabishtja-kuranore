# Arabishtja Kuranore

## Overview
An interactive learning tool for students studying Quranic Arabic, serving as an educational whiteboard. The application content is in Albanian (Shqip).

## PWA Configuration
- Progressive Web App (PWA) compatible with manifest.json file
- Service worker for offline caching of static assets
- Installable on mobile and desktop devices
- Standalone display mode for native app-like experience
- Proper meta tags for mobile installation prompts
- Theme and background colors matching the app's visual design
- Uses `icon.png` as the official app icon for all PWA configurations
- Multiple icon sizes generated from `icon.png` for different device requirements (192x192, 512x512, 180x180 for Apple touch icon, 32x32 for favicon)
- All PWA icons reference `icon.png` without any modifications, resizing, cropping, or color adjustments
- Splash screen support for iOS and Android
- App name in manifest.json set to "Arabishtja Kuranore" only
- **Orientation support**: Supports both portrait and landscape orientations in manifest.json
- Responsive design optimized for both portrait and landscape viewing modes
- All features and layouts adapt seamlessly to orientation changes

## PWA Installation Features
- Install prompt appears as a slide-up pop-up at the bottom of the screen when `beforeinstallprompt` event is detected
- Pop-up asks user "Dëshiron ta instalosh aplikacionin?" with "Po" (Yes) and "Jo" (No) buttons
- Pop-up is styled to be responsive, minimalistic, and user-friendly
- Animated appearance from the bottom for better UX integration
- If user accepts, triggers installation flow and remembers choice to avoid showing pop-up again
- Detects if app is already installed via `window.matchMedia('(display-mode: standalone)')` or `navigator.standalone`
- Does not show install pop-up if app is already installed
- Pop-up uses `icon.png` for visual presentation without any modifications
- All pop-up content localized in Albanian

## Authentication & User Management
- Uses Internet Identity for authentication
- New users must provide their name during first registration
- Default role for all users is "Nxënës" (Student)
- Backend stores user profiles with name, avatar, and role
- Multiple administrators are supported through a list of authorized principal IDs including:
  - `"cuxna-it63h-trwek-y6k5d-w4bm3-4m3km-btppv-5bjnb-54vun-qkpqi-sqe"`
  - `"jblrk-velg3-evgb7-7btqq-4qggo-rwz4h-au6fc-lga3s-v4ksn-wezrv-nqe"`

## User Profile System
- Profile page displays:
  - Name (editable)
  - Avatar (editable via image upload)
  - Principal ID (read-only)
- Profile menu accessible via icon in top-right corner showing:
  - Name and role (display only)
  - "Profili" (Profile page link)
  - "Cilësimet" (Settings page link)

## Role System
The application supports three user roles:
- **Nxënës** (Student) - Default role for new users
- **Mësuesi** (Teacher) - Can access lesson creation features and vocabulary management
- **Administrator** - Full system access, displayed as "Mësuesi" in the UI

## Navigation Structure
Bottom navigation bar with five main sections, dynamically shown based on user role:
1. **Dërrasa** (Whiteboard) - Main learning and explanation interface (visible to all roles)
2. **Mësimet** (Lessons) - List of saved or prepared lessons (visible to all roles: "Nxënës", "Mësuesi", and "Administrator")
3. **Kuiz** (Quiz) - Quiz creation and taking interface (visible to all roles)
4. **Fjalori** (Vocabulary) - Global vocabulary page (visible to all roles: "Nxënës", "Mësuesi", and "Administrator")
5. **Shënime** (Notes) - Personal notes page (visible to all user roles)

## Core Features

### Whiteboard (Dërrasa)
- Interactive learning interface for Arabic explanations
- Dynamically displays the active lesson's title as the page title
- Shows the active lesson's content as the page subtitle with **proper line break and paragraph formatting**:
  - **Preserves original line breaks and paragraphs** from the lesson content text
  - Uses React-safe HTML rendering approach (e.g., `white-space: pre-line` styling or equivalent)
  - Maintains newlines and paragraph spacing to respect the original formatting
  - Does not modify any existing color, typography, or layout styles
  - **Content expansion/collapse functionality**:
    - When lesson content text is long, initially displays only a shortened preview
    - Small expand/collapse icon positioned beneath the content text
    - Clicking the icon expands to show the full content text
    - Clicking again collapses back to the shortened preview
    - Full text preserves all line breaks and paragraph formatting when expanded
    - Icon and functionality maintain existing app styling and colors
    - Smooth transition between collapsed and expanded states
- Displays complete lesson details in structured sections:
  - **Fjalët e reja** (New Words) section: Each word from the active lesson displayed as an accordion item that expands to show:
    - Albanian meanings for the word (displayed with increased font size for better readability)
    - Available forms of the word (displayed with increased font size for better readability)
    - **Interactive word forms**: Each word form is clickable and displays its corresponding meaning as a small tooltip or floating label above the Arabic form when clicked
    - **Form meaning tooltips**: Appear unobtrusively above the clicked word form and disappear when clicking elsewhere
    - Note management buttons for adding, editing, or deleting personal notes related to the word
  - **Shembujt** (Examples) section: Each ayah from the active lesson displayed as an accordion item that expands to show:
    - Albanian translation (meaning) of the ayah
    - Reference information (Surah and verse number)
    - Note management buttons for adding, editing, or deleting personal notes related to the ayah
- **Updated card layout for word and ayah accordion items**:
  - **Removed vertical padding**: Card containers no longer use `py-6` class to minimize vertical spacing
  - **Rearranged layout**: 
    - Notes indicator positioned on the **left side** of the card
    - Word or ayah text positioned on the **right side** of the card, **right-aligned**
    - **No chevron-down icon displayed** - the accordion expansion is controlled through full card clickability without any visual arrow indicators
    - **No arrow displayed anywhere on the card** - clean layout without expansion indicators
  - **Full card clickability**: The entire card area is clickable to toggle accordion expansion
  - All colors, themes, and typography remain consistent with existing app design
- Note management functionality:
  - Small buttons or icons within each accordion for note actions
  - When clicked, opens a modal or inline form for note content editing
  - Notes are saved to the user's personal notes collection and linked to the specific word or ayah
  - Visual indicator when a note exists for a word or ayah
  - **Stable associatedId handling**: Uses consistent ID format for note association:
    - For words: `word:${lesson.id}:${word.arabic}`
    - For ayahs: `ayah:${lesson.id}:${ayahIndex}`
  - WordAccordionItem and AyahAccordionItem components receive lesson.id as a prop
  - All note creation, modification, and retrieval functions use these stable associatedId values consistently
- Backend provides query to return the active lesson with all associated vocabulary and ayah data
- Content is displayed only for lessons marked as active by teachers
- Sections update dynamically when the active lesson changes
- All content properly formatted and visible in both light and dark mode
- Maintains all existing colors, typography, spacing, and component styles unchanged (except for the updated card layout and increased font size for word meanings and forms)
- Maintains responsive design and existing styling
- Accordion components use consistent styling with the existing app theme

### Lessons (Mësimet)
- Display list of available lessons
- **Accessible to all user roles: "Nxënës" (Student), "Mësuesi" (Teacher), and "Administrator"**
- **Student visibility control**: Students can only see lessons that are marked as "visible to students" by teachers/administrators
- **Role-based functionality**:
  - **For Teachers and Administrators**:
    - Material Design-style floating action button ("+") in bottom-right corner
    - Floating action button navigates to the NewLessonPage when pressed
    - Each lesson card includes:
      - Delete button visible only to teachers/administrators
      - Edit button visible only to teachers/administrators
      - Activate button visible only to teachers/administrators
      - **"Visible to Students" toggle** visible only to teachers/administrators
    - Delete action requires confirmation via dialog before execution
    - Edit button navigates to the EditLessonPage with the lesson data pre-populated
    - **Visibility toggle functionality**:
      - Toggle switch or checkbox to control lesson visibility to students
      - When toggled, immediately updates the lesson's visibility status in the backend
      - Visual indicator shows current visibility state
      - Maintains existing styling consistent with other lesson management controls
  - **For Students**:
    - Each lesson card displays lesson information without edit/delete/activate/visibility buttons
    - **Only lessons marked as "visible to students" are displayed**
    - Clicking on a lesson card opens the lesson in **read-only view mode**
    - No floating action button visible to students
- **Read-only lesson view for students**:
  - Dedicated page displaying complete lesson details
  - Shows lesson title as page header
  - Displays lesson content with **proper line break and paragraph formatting**:
    - **Preserves original line breaks and paragraphs** from the lesson content text
    - Uses React-safe HTML rendering approach (e.g., `white-space: pre-line` styling or equivalent)
    - Maintains newlines and paragraph spacing to respect the original formatting
  - **Content expansion/collapse functionality** (same as Whiteboard):
    - When lesson content text is long, initially displays only a shortened preview
    - Small expand/collapse icon positioned beneath the content text
    - Clicking the icon expands to show the full content text
    - Clicking again collapses back to the shortened preview
  - Displays lesson's associated words and ayahs in structured sections:
    - **Fjalët e reja** (New Words) section: Each word displayed as an accordion item that expands to show:
      - Albanian meanings for the word (displayed with increased font size for better readability)
      - Available forms of the word (displayed with increased font size for better readability)
      - **Interactive word forms**: Each word form is clickable and displays its corresponding meaning as a small tooltip or floating label above the Arabic form when clicked
      - **Form meaning tooltips**: Appear unobtrusively above the clicked word form and disappear when clicking elsewhere
    - **Shembujt** (Examples) section: Each ayah displayed as an accordion item that expands to show:
      - Albanian translation (meaning) of the ayah
      - Reference information (Surah and verse number)
  - **Updated card layout** (same as Whiteboard):
    - **Removed vertical padding**: Card containers no longer use `py-6` class to minimize vertical spacing
    - **Rearranged layout**: Word or ayah text positioned on the **right side** of the card, **right-aligned**
    - **No chevron-down icon displayed** - clean layout without expansion indicators
    - **Full card clickability**: The entire card area is clickable to toggle accordion expansion
  - **No editing capabilities**: All editing, deleting, activating, and creation actions are hidden or disabled
  - Uses existing app styling, colors, and layout patterns
  - Maintains responsive design and existing component styling
- Backend stores lesson data including content, metadata, active status, and **visibility to students flag**
- Backend provides `createLesson` function for teachers and administrators to create new lessons
- Backend provides `deleteLesson` function for teachers and administrators to delete lessons by ID
- Backend provides `setLessonActive` function for teachers and administrators to mark lessons as active (automatically deactivates all other lessons)
- Backend provides `updateLesson` function for teachers and administrators to modify existing lesson data
- **Backend provides `setLessonVisibility` function** for teachers and administrators to control lesson visibility to students
- **Backend provides `getLessonById` function** for retrieving complete lesson details including associated words and ayahs for read-only viewing
- **Backend provides `getAllLessons` function** accessible to all users for displaying the lessons list:
  - For teachers and administrators: returns all lessons regardless of visibility status
  - For students: returns only lessons marked as visible to students
- **Backend provides `getVisibleLessons` function** specifically for student access to retrieve only lessons marked as visible

### New Lesson Creation (NewLessonPage)
- Dedicated page for creating new lessons
- Accessible only to users with "Mësuesi" (Teacher) or "Administrator" roles
- Opened when clicking the "+" floating action button from the Lessons page
- **Lesson visibility setting**:
  - **"Visible to Students" toggle** included in the lesson creation form
  - Toggle allows teachers/administrators to set initial visibility status for new lessons
  - Default visibility setting can be configured (e.g., visible by default or hidden by default)
  - Toggle maintains existing form styling and layout patterns
- Contains two main sections with clear visual separation:
  1. **Fjalori** (Vocabulary) section:
     - Section title displayed prominently
     - "Shto Fjalë" button for adding new words to the lesson's vocabulary list
     - When adding a new word, form includes fields for:
       - Arabic word text
       - Albanian meaning(s) with ability to add multiple meanings dynamically
       - Available forms of the Arabic word
       - **Meanings for each word form**: Each Arabic form field has a corresponding meaning input field displayed side-by-side in the same row
     - Each saved word in the lesson displays:
       - Word information (Arabic text, Albanian meanings, forms, and form meanings)
       - **Edit** button for each word
       - **Delete** button for each word
       - When Edit button is clicked, opens an editable dialog prefilled with existing data:
         - Arabic word text (editable)
         - Albanian meanings (editable with ability to add/remove meanings)
         - Available forms (editable)
         - **Form meanings (editable)**: Each form field paired with its corresponding meaning field in the same row
       - Updated word data immediately reflects in the lesson's word list
       - Dialog allows saving changes or canceling edits
       - When Delete button is clicked, removes the word from the lesson's vocabulary list
  2. **Ajetet** (Verses) section:
     - Section title displayed prominently
     - "Shto Ajet" button for adding new ayahs (verses) to the lesson
     - When clicking "Shto Ajet", opens a modal or form section with fields for:
       - Ayah text (Arabic verse)
       - Optional translation (Albanian)
       - Optional reference (Surah and verse number)
     - Added ayahs are displayed in the section with:
       - Ayah information (Arabic text, Albanian translation, reference)
       - **Edit** button for each ayah
       - When Edit button is clicked, opens an editable dialog prefilled with existing data:
         - Ayah text (editable)
         - Albanian translation (editable)
         - Reference information (editable)
       - Updated ayah data immediately reflects in the lesson's ayah list
       - Dialog allows saving changes or canceling edits
     - Backend integration to save ayahs as part of the lesson data
- Clean layout using Material Design components
- Responsive design suitable for educational use
- All existing colors, themes, and UI styles maintained unchanged

### Edit Lesson (EditLessonPage)
- Dedicated page for editing existing lessons
- Accessible only to users with "Mësuesi" (Teacher) or "Administrator" roles
- Opened when clicking the "Edit" button on a lesson card
- Pre-populates all existing lesson data including:
  - Lesson title and content
  - **Current visibility to students setting**
  - All vocabulary words with their meanings, forms, and form meanings
  - All associated ayahs (verses) with their text, translations, and references
- **Lesson visibility editing**:
  - **"Visible to Students" toggle** included in the lesson editing form
  - Toggle shows current visibility status and allows modification
  - Changes to visibility are saved when the lesson is updated
  - Toggle maintains existing form styling consistent with other lesson management controls
- Uses the same form structure and layout as the NewLessonPage
- Contains the same two main sections:
  1. **Fjalori** (Vocabulary) section with existing words displayed and editable:
     - Each saved word displays with an **Edit** button and **Delete** button
     - When Edit button is clicked, opens an editable dialog prefilled with existing data:
       - Arabic word text (editable)
       - Albanian meanings (editable with ability to add/remove meanings)
       - Available forms (editable)
       - **Form meanings (editable)**: Each form field paired with its corresponding meaning field in the same row
     - Updated word data immediately reflects in the lesson's word list
     - Dialog allows saving changes or canceling edits
     - When Delete button is clicked, removes the word from the lesson's vocabulary list
     - Edit button styling consistent with existing lesson card buttons and NewLessonPage edit buttons
  2. **Ajetet** (Verses) section with existing verses displayed and editable:
     - Each saved ayah displays with an **Edit** button
     - When Edit button is clicked, opens an editable dialog prefilled with existing data:
       - Ayah text (editable)
       - Albanian translation (editable)
       - Reference information (editable)
     - Updated ayah data immediately reflects in the lesson's ayah list
     - Dialog allows saving changes or canceling edits
     - Edit button styling consistent with existing lesson card buttons and word edit buttons
- Allows adding new vocabulary words and verses to the existing lesson
- Allows editing or removing existing vocabulary words and verses
- Backend updates the lesson data when changes are saved
- Word edit dialog styling consistent with existing modal and form components
- Ayah edit dialog styling consistent with existing modal and form components
- Maintains all existing page styling and layout unchanged

### Quiz Page (Kuiz)
- Dedicated page for quiz management and taking
- **Accessible to all user roles: "Nxënës" (Student), "Mësuesi" (Teacher), and "Administrator"**
- **For Teachers and Administrators**:
  - Display list of created quizzes
  - Material Design-style floating action button ("+") in bottom-right corner for creating new quizzes
  - Each quiz card displays:
    - Quiz name and type
    - Creation date
    - Edit and delete buttons (visible only to teachers/administrators)
  - Delete action requires confirmation via dialog before execution
- **For Students**:
  - Display list of available quizzes assigned by teachers
  - Each quiz card shows:
    - Quiz name and type
    - "Fillo Kuizin" (Start Quiz) button
- **Quiz Creation (NewQuizPage)**:
  - Accessible only to users with "Mësuesi" (Teacher) or "Administrator" roles
  - Form for creating new quizzes with fields:
    - Quiz name
    - Quiz type selection with two available types:
      - "Word Guess" type
      - **"Multiple Choice" type**
  - **Word Guess Quiz Type**:
    - Automatically selects 10 random words from the global vocabulary (or all available words if fewer than 10)
    - No additional configuration needed for this quiz type
  - **Multiple Choice Quiz Type**:
    - Automatically selects 10 random words from the global vocabulary (or all available words if fewer than 10)
    - For each question, uses the Arabic word as the question and generates four Albanian meaning options (one correct, three incorrect)
    - No additional configuration needed for this quiz type
  - Backend stores quiz data including name, type, and configuration
- **Quiz Taking Interface**:
  - **Word Guess Quiz Flow**:
    - Displays one question at a time out of 10 total questions
    - Each question shows a card with the Arabic word
    - Card is clickable to flip and reveal the Albanian meaning
    - After flipping, student selects "Po" (Yes) or "Jo" (No) to indicate if they knew the word
    - Progress indicator showing current question number (e.g., "Pyetja 3 nga 10")
    - "Vazhdo" (Continue) button to proceed to next question after answering
  - **Multiple Choice Quiz Flow**:
    - Displays one question at a time out of 10 total questions
    - Each question shows the Arabic word as the question
    - Four selectable answer buttons displaying Albanian meanings (one correct, three incorrect)
    - **Answer selection behavior**:
      - When a user selects an answer choice, it is highlighted visually using existing theme and color styles
      - If the user clicks on another choice for the same question, the previously selected answer is unselected and replaced by the new choice
      - The system stores the updated selection in the current quiz session state without finalizing it until the quiz is completed
      - Users can change their answer multiple times before proceeding to the next question
    - Progress indicator showing current question number (e.g., "Pyetja 3 nga 10")
    - "Vazhdo" (Continue) button to proceed to next question after selecting an answer
    - Answer buttons remain interactive until the user proceeds to the next question
  - **Results Summary Page**:
    - Displays after completing all 10 questions
    - Shows total correct and incorrect counts
    - **For Word Guess quizzes**: Lists all incorrect words with their correct Albanian meanings
    - **For Multiple Choice quizzes**: Lists all incorrect answers showing the Arabic word, the student's selected answer, and the correct Albanian meaning
    - "Përfundo" (Finish) button to return to quiz list
- Navigation tab visible to all users in the bottom navigation bar
- Maintains all existing colors, fonts, and styles unchanged
- Card flip animation for word reveal in Word Guess quiz taking
- Clean, organized layout consistent with existing app design

### Vocabulary Page (Fjalori)
- Dedicated page displaying all saved words from all lessons
- **Accessible to all user roles: "Nxënës" (Student), "Mësuesi" (Teacher), and "Administrator"**
- Shows words in a **simple sortable table view** format with:
  - **Header row** that allows sorting by Arabic words or by their Albanian meanings
  - Each table row containing:
    - **Arabic word** aligned to the **right side** of the row, **clickable to open the word details dialog**
    - **First Albanian meaning** aligned to the **left side** of the row, initially hidden under a placeholder of **five asterisks (*****)** that toggles visibility **on click** to reveal or hide the first meaning
    - **Delete button** visible only to users with "Mësuesi" (Teacher) or "Administrator" roles
- **Word deletion functionality**:
  - Delete button appears in each table row for teachers and administrators
  - When clicked, backend checks if the word exists in any lesson
  - If word is associated with any lesson, shows error message: "Kjo fjalë nuk mund të fshihet sepse është pjesë e një mësimi ekzistues."
  - If word is not used in any lesson, allows deletion and removes word from vocabulary
  - After successful deletion, refreshes the vocabulary table
  - Delete button maintains existing styling consistent with other action buttons
- **Word details dialog** displays:
  - **Main Arabic word text centered horizontally**
  - Complete word information including Arabic text
  - All Albanian meanings
  - **All available forms aligned to the right side of their container**
  - **Interactive word forms**: Each word form is clickable and displays its corresponding meaning as a small tooltip or floating label above the Arabic form when clicked
  - **Form meaning tooltips**: Appear unobtrusively above the clicked word form and disappear when clicking elsewhere
  - Dialog maintains existing theme styling and is clearly formatted for user readability
- Navigation tab visible to all users in the bottom navigation bar
- Maintains all existing colors, fonts, and styles of the page unchanged
- Compatible with all existing user roles as before

### Notes Page (Shënime)
- Dedicated page for managing personal notes
- Accessible to all user roles (Administrator, Mësuesi, Nxënës)
- Displays all notes created by the logged-in user
- Shows notes organized by their associated words or ayahs
- Each note entry displays:
  - The associated word or ayah it relates to
  - The note content
  - Creation/modification date
  - Edit and delete options
- Notes are user-specific and private to each individual user
- Clean, organized layout consistent with existing app design
- Search or filter functionality for finding specific notes
- Navigation tab visible to all users in the bottom navigation bar

### Settings Dialog
- Settings dialog accessible from the profile menu
- Contains application settings and configuration options
- **Reset App Data** functionality:
  - "Reset App Data" button visible only to administrators
  - When clicked, shows confirmation dialog with message "Are you sure you want to reset all app data?" in Albanian
  - If confirmed, triggers backend `resetAppData` method to clear all application data
  - After successful reset, displays toast notification "App data successfully reset" in Albanian
  - Maintains all existing styles, colors, and layouts unchanged

## Backend Data Storage
- User profiles (name, avatar, principal ID, role)
- Lesson content, metadata, active status (Boolean field), and **visibility to students flag (Boolean field)**
- Word vocabulary data including:
  - Arabic word text
  - Albanian meanings (multiple)
  - Available forms
  - **Form meanings**: Meanings corresponding to each word form
  - Associated lesson ID
- Ayah data associated with lessons including:
  - Ayah text (Arabic verse)
  - Optional translation (Albanian)
  - Optional reference (Surah and verse number)
  - Associated lesson ID
- **Quiz data storage**:
  - Quiz metadata (name, type, creator, creation date)
  - Quiz configuration based on type
  - Quiz assignments to students (for future expansion)
  - Quiz results and progress tracking
  - **Multiple Choice quiz support**: Backend generates incorrect answer options by randomly selecting Albanian meanings from other words in the vocabulary
- **Per-user notes storage** using a nested Map structure:
  - Primary Map keyed by Principal (user) containing individual user note Maps
  - Each user's Map keyed by note ID containing Note data
  - Note data includes:
    - Note content
    - Associated word ID or ayah ID
    - User principal ID (creator)
    - Creation and modification timestamps
    - Note type (word or ayah)
- User-specific lesson associations
- Global vocabulary storage for cross-lesson word access
- Role-based access control for lesson creation, deletion, activation, editing, and vocabulary management functionality
- Multiple administrator principals with permanent privileges stored in a list or set
- Backend query to retrieve active lesson with complete details including associated words and ayahs
- Backend enforces single active lesson constraint: when a lesson is activated, all other lessons are automatically deactivated
- Backend functions for ayah management:
  - Add ayahs to specific lessons
  - Edit existing ayahs within lessons
  - Update individual ayah data (text, translation, reference) while preserving lesson linkage
  - Retrieve ayahs when fetching lesson data
  - Delete ayahs from lessons
- Backend functions for note management:
  - Create notes linked to specific words or ayahs within user-specific storage
  - Update existing user notes within the user's own note collection
  - Delete user notes from the user's own note collection
  - Retrieve all notes for a specific user from their personal note Map
  - Retrieve notes for specific words or ayahs by user from their personal note Map
  - **Note ID generation**: Uses a global counter `stable var nextNoteId : Nat = 0;` to ensure unique and non-reused IDs for notes across all users
  - In `createNote()` function, note ID is generated using `Nat.toText(nextNoteId)` and then `nextNoteId` is incremented by 1
  - **Helper function** `getUserNotesMap(user: Principal)` to retrieve or create user-specific note Maps
- **Quiz management functions**:
  - `createQuiz` function for teachers and administrators to create new quizzes
  - `deleteQuiz` function for teachers and administrators to delete quizzes by ID
  - `getQuizzes` function to retrieve quizzes (all for teachers, assigned for students)
  - `getRandomWords` function to select random words for Word Guess and Multiple Choice quiz types
  - **`generateMultipleChoiceOptions` function**: Creates four answer options for Multiple Choice quizzes by selecting one correct Albanian meaning and three random incorrect meanings from other vocabulary words
  - Quiz result tracking and storage for student progress
- **App Data Reset functionality**:
  - `resetAppData` backend method accessible only to administrators
  - Clears all stored data maps: `userProfiles`, `lessons`, `vocabulary`, `lessonWords`, `lessonAyahs`, `notesByUser`, and `quizzes`
  - Resets `AccessControlState` by clearing all users and assigned roles (sets `adminAssigned` to `false`, empties `userRoles`)
  - Securely validates admin privileges before executing reset operation
- **Word deletion functionality**:
  - `deleteWord` backend method accessible only to teachers and administrators
  - `checkWordInLessons` backend method to verify if a word exists in any lesson before deletion
  - Word deletion only permitted if word is not associated with any existing lesson
  - Backend validates teacher/administrator privileges before allowing word deletion
- **Enhanced word deletion from lessons**:
  - `removeWordFromLesson` backend method for removing words from specific lessons
  - When a word is deleted from a lesson, it is removed from the `lessonWords` mapping for that specific lesson
  - The word is only permanently deleted from the global `vocabulary` map if it is not referenced by any other lesson
  - Uses existing `checkWordInLessons` logic to determine if the word can be permanently removed
  - Proper synchronization between `vocabulary` map and `lessonWords` mapping to maintain data consistency
  - Handles cases where words are shared among multiple lessons by only removing the lesson-specific association
- **Lesson access functions**:
  - `getAllLessons` function accessible to all users for displaying the lessons list:
    - For teachers and administrators: returns all lessons regardless of visibility status
    - For students: returns only lessons marked as visible to students
  - **`getLessonById` function** accessible to all users for retrieving complete lesson details including associated words and ayahs for read-only viewing
  - **`getVisibleLessons` function** specifically for student access to retrieve only lessons marked as visible
  - Role-based access control ensures students can only view lessons in read-only mode while teachers and administrators retain full editing capabilities
- **Lesson visibility management functions**:
  - **`setLessonVisibility` function** for teachers and administrators to control lesson visibility to students
  - **`updateLessonVisibility` function** for modifying visibility status of existing lessons
  - Backend stores and manages the visibility flag for each lesson
  - Visibility changes are immediately reflected in student lesson lists
- All admin privilege checks validate against the list of authorized administrator principal IDs
- Admin-specific features (lesson creation, deletion, activation, user promotions, viewing all users, app data reset, word deletion) recognize all principals in the administrator list
- **Word data structure updated** to include form meanings alongside existing form data
- Backend functions for word management updated to handle form meanings:
  - Create words with form meanings
  - Update existing words including form meanings
  - Retrieve words with complete form and form meaning data

## Design Requirements
- Clean, modern, and beginner-friendly interface
- Tailwind CSS for styling
- Responsive design suitable for educational use and optimized for both portrait and landscape orientations
- PWA-optimized interface for mobile and desktop installation with orientation flexibility
- Material Design floating action button styling
- Material Design components for the NewLessonPage, EditLessonPage, Fjalori page, Shënime page, and Quiz pages
- Consistent theme integration for new UI elements
- Confirmation dialogs for destructive actions (lesson deletion, note deletion, quiz deletion, app data reset)
- Clear visual separation between sections on the NewLessonPage and EditLessonPage
- Maintain all existing colors, formatting, and button styles unchanged across all pages
- Preserve existing layout structures and styling on the Whiteboard page while implementing the updated card layout and **proper line break formatting for lesson content**
- **Line break and paragraph formatting**: Lesson content subtitle uses React-safe HTML rendering approach (e.g., `white-space: pre-line` styling or equivalent) to preserve original formatting without modifying existing color, typography, or layout styles
- **Content expansion/collapse styling**: Expand/collapse icon beneath lesson content maintains existing app styling and colors with smooth transitions between collapsed and expanded states
- Accordion components for word display with proper expand/collapse functionality
- Content visibility and proper formatting in both light and dark mode
- Edit button styling consistent with existing lesson card buttons
- Modal or form styling for note addition and editing consistent with existing design patterns
- Note management buttons integrated seamlessly within existing accordion components
- Visual indicators for items that have associated notes
- Consistent styling for the new Shënime page matching existing app theme and layout patterns
- All app components that display the app icon (Header.tsx, PWAInstallDialog.tsx, login page logo) must use `icon.png` without any modifications
- App icon references in manifest.json and PWA configuration must point to `icon.png`
- Keep existing style, layout, and theming completely unchanged while updating icon references
- Settings dialog maintains existing styling while adding the new reset functionality
- Toast notifications use existing app styling and theming
- Word edit dialog styling consistent with existing modal and form components
- Edit buttons for words in lesson creation styled consistently with other action buttons
- Ayah edit dialog styling consistent with existing modal and form components
- Edit buttons for ayahs styled consistently with word edit buttons and other action buttons
- Increased font size for word meanings and forms in Dërrasa page while maintaining all other styling aspects
- **Orientation adaptability**: All UI components and layouts adapt seamlessly to both portrait and landscape orientations
- Navigation and content remain fully functional across orientation changes
- Vocabulary page table view maintains existing colors, fonts, and styles while implementing the new sortable table layout with header row and proper alignment
- Details dialog on vocabulary page uses existing theme styling and maintains clear formatting for readability
- **Dynamic navigation**: Bottom navigation bar dynamically shows or hides tabs based on user role, ensuring role-appropriate access control
- **Updated card layout styling**: Word and ayah accordion cards implement the clean layout with removed vertical padding, notes indicator positioned on the left side, word/ayah text right-aligned on the right side, no chevron-down icons or arrow indicators, and full card clickability for accordion expansion
- **Vocabulary page interaction updates**: Arabic word cells are clickable to open word details dialog, with Arabic text remaining right-aligned and all existing styles preserved
- **Word details dialog formatting**: Main Arabic word text is centered horizontally, and all word forms are aligned to the right side of their container while maintaining existing theme styling
- **Add/Edit Word Dialog enhancements**: Form meaning fields are displayed side-by-side with their corresponding Arabic form fields in the same row, maintaining existing dialog styling and layout patterns
- **Interactive word form tooltips**: Small, unobtrusive tooltips or floating labels that appear above clicked word forms showing their meanings, with consistent styling across all pages that display word forms
- **Tooltip behavior**: Form meaning tooltips appear on click and disappear when clicking elsewhere, maintaining existing color schemes and typography
- **Delete button styling**: Word delete buttons in vocabulary table maintain existing styling consistent with other action buttons and are properly integrated into the table layout
- **Error message styling**: Error messages for word deletion restrictions use existing toast notification styling and theming
- **Word deletion from lessons styling**: Delete buttons for words within lesson creation and editing maintain existing styling consistent with other action buttons
- **Quiz interface styling**: All quiz components (cards, buttons, progress indicators, results) maintain existing app colors, fonts, and design patterns
- **Card flip animation**: Smooth, educational-friendly animation for word card reveals in Word Guess quiz taking
- **Quiz navigation**: Clean, intuitive navigation between quiz questions and results consistent with existing app flow patterns
- **Multiple Choice quiz styling**: Answer buttons for Multiple Choice quizzes maintain existing app styling and are clearly distinguishable when selected or disabled
- **Multiple Choice answer selection styling**: Selected answer choices are highlighted visually using existing theme and color styles, with smooth transitions when changing selections
- **Quiz type selection styling**: Quiz type selection in NewQuizPage maintains existing form styling and clearly displays both "Word Guess" and "Multiple Choice" options
- **Read-only lesson view styling**: Student read-only lesson view maintains all existing app styling, colors, and layout patterns while hiding editing capabilities
- **Role-based UI elements**: Action buttons (edit, delete, activate, create) are conditionally displayed based on user role while maintaining consistent styling when visible
- **Lesson card styling**: Lesson cards maintain existing styling while adapting clickable behavior based on user role (edit mode for teachers/admins, read-only view for students)
- **Lesson visibility toggle styling**: 
  - "Visible to Students" toggle maintains existing form control styling consistent with other lesson management elements
  - Toggle switch or checkbox uses existing app theme colors and styling patterns
  - Visual indicator clearly shows current visibility state using existing design language
  - Toggle positioning and layout integrate seamlessly with existing lesson card and form layouts
  - All visibility controls maintain consistent styling across lesson creation, editing, and management interfaces
